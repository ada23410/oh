"use strict";(self["webpackChunkoh"]=self["webpackChunkoh"]||[]).push([[76],{4245:function(e,t,a){a.d(t,{A:function(){return k}});var l=a(6768),r=a(4232),d=a(5130);const s={"aria-label":"Page navigation"},i={class:"pagination justify-content-center"},n=["onClick"];function o(e,t,a,o,u,p){return(0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("ul",i,[(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:!a.pages.has_pre}])},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,d.D$)((e=>p.updatePage(a.pages.current_page-1)),["prevent"]))},t[2]||(t[2]=[(0,l.Lk)("span",{"aria-hidden":"true"},"«",-1)]))],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.pages.total_pages,(e=>((0,l.uX)(),(0,l.CE)("li",{class:(0,r.C4)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:(0,d.D$)((t=>p.updatePage(e)),["prevent"])},(0,r.v_)(e),9,n)],2)))),128)),(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:!a.pages.has_next}])},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,d.D$)((e=>p.updatePage(a.pages.current_page+1)),["prevent"]))},t[3]||(t[3]=[(0,l.Lk)("span",{"aria-hidden":"true"},"»",-1)]))],2)])])}var u={props:["pages"],methods:{updatePage(e){this.$emit("emit-pages",e)}}},p=a(1241);const c=(0,p.A)(u,[["render",o]]);var k=c},76:function(e,t,a){a.r(t),a.d(t,{default:function(){return J}});var l=a(6768),r=a(4232),d=a(5130);const s={class:"card p-3"},i={class:"table"},n={class:"text-right"},o={class:"list-unstyled"},u={class:"text-right"},p={class:"form-check form-switch"},c=["id","onUpdate:modelValue","onChange"],k=["for"],h={key:0},L={key:1},m={class:"btn-group"},g=["onClick"],b=["onClick"],v={class:"pagination-wrapper"};function O(e,t,a,O,_,f){const C=(0,l.g2)("Loading"),y=(0,l.g2)("pagination"),M=(0,l.g2)("orderModal"),$=(0,l.g2)("deleteOrderModal");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(C,{active:_.isLoading},null,8,["active"]),t[1]||(t[1]=(0,l.Lk)("div",{class:"function"},[(0,l.Lk)("h5",null,"訂單管理")],-1)),(0,l.Lk)("div",s,[(0,l.Lk)("table",i,[t[0]||(t[0]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{width:"120"},"購買時間"),(0,l.Lk)("th",{width:"120"},"E-mail"),(0,l.Lk)("th",{width:"120"},"購買款項"),(0,l.Lk)("th",{width:"100"},"應付金額"),(0,l.Lk)("th",{width:"100"},"是否付款"),(0,l.Lk)("th",{width:"120"},"編輯")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_.orders,((t,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:a},[(0,l.Lk)("td",null,(0,r.v_)(e.$filters.date(t.create_at)),1),(0,l.Lk)("td",null,(0,r.v_)(t.user.email),1),(0,l.Lk)("td",n,[(0,l.Lk)("ul",o,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.products,((e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t},(0,r.v_)(e.product.title)+" 數量："+(0,r.v_)(e.qty)+" "+(0,r.v_)(e.product.unit),1)))),128))])]),(0,l.Lk)("td",u,(0,r.v_)(t.total),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",p,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${t.id}`,"onUpdate:modelValue":e=>t.is_paid=e,onChange:e=>f.updateOrder(t)},null,40,c),[[d.lH,t.is_paid]]),(0,l.Lk)("label",{class:"form-check-label",for:`paidSwitch${t.id}`},[t.is_paid?((0,l.uX)(),(0,l.CE)("span",h,"已付款")):((0,l.uX)(),(0,l.CE)("span",L,"未付款"))],8,k)])]),(0,l.Lk)("td",null,[(0,l.Lk)("div",m,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>f.openModal(!1,t)},"檢視",8,g),(0,l.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>f.openDeleteModal(t)},"刪除",8,b)])])])))),128))])])]),(0,l.Lk)("div",v,[(0,l.bF)(y,{pages:_.pagination,onEmitPages:f.getOrders},null,8,["pages","onEmitPages"])]),(0,l.bF)(M,{ref:"orderModal",order:_.tempOrder,onUpdateOrder:f.updateOrder},null,8,["order","onUpdateOrder"]),(0,l.bF)($,{ref:"deleteOrderModal",order:_.tempOrder,onConfirmDelete:f.deleteOrder},null,8,["order","onConfirmDelete"])],64)}const _={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},f={class:"modal-dialog modal-xl",role:"document"},C={class:"modal-content border-0"},y={class:"modal-body"},M={class:"row"},$={class:"col-md-4"},E={class:"table"},w={key:0},x={class:"col-md-8"},X={class:"table"},P={key:0},F={key:1},A={key:0,class:"text-success"},D={key:1,class:"text-muted"},K={class:"table"},I={class:"text-end"},U={class:"modal-footer"};function j(e,t,a,d,s,i){return(0,l.uX)(),(0,l.CE)("div",_,[(0,l.Lk)("div",f,[(0,l.Lk)("div",C,[t[15]||(t[15]=(0,l.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,l.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l.Lk)("span",null,"訂單細節")]),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",y,[(0,l.Lk)("div",M,[(0,l.Lk)("div",$,[t[5]||(t[5]=(0,l.Lk)("h3",null,"用戶資料",-1)),(0,l.Lk)("table",E,[s.tempOrder.user?((0,l.uX)(),(0,l.CE)("tbody",w,[(0,l.Lk)("tr",null,[t[1]||(t[1]=(0,l.Lk)("th",{style:{width:"100px"}},"姓名",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.name),1)]),(0,l.Lk)("tr",null,[t[2]||(t[2]=(0,l.Lk)("th",null,"Email",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.email),1)]),(0,l.Lk)("tr",null,[t[3]||(t[3]=(0,l.Lk)("th",null,"電話",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.tel),1)]),(0,l.Lk)("tr",null,[t[4]||(t[4]=(0,l.Lk)("th",null,"地址",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.address),1)])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",x,[t[12]||(t[12]=(0,l.Lk)("h3",null,"訂單細節",-1)),(0,l.Lk)("table",X,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[6]||(t[6]=(0,l.Lk)("th",{style:{width:"100px"}},"訂單編號",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.id),1)]),(0,l.Lk)("tr",null,[t[7]||(t[7]=(0,l.Lk)("th",null,"下單時間",-1)),(0,l.Lk)("td",null,(0,r.v_)(e.$filters.date(s.tempOrder.create_at)),1)]),(0,l.Lk)("tr",null,[t[8]||(t[8]=(0,l.Lk)("th",null,"付款時間",-1)),(0,l.Lk)("td",null,[s.tempOrder.paid_date?((0,l.uX)(),(0,l.CE)("span",P,(0,r.v_)(e.$filters.date(s.tempOrder.paid_date)),1)):((0,l.uX)(),(0,l.CE)("span",F,"時間不正確"))])]),(0,l.Lk)("tr",null,[t[9]||(t[9]=(0,l.Lk)("th",null,"付款狀態",-1)),(0,l.Lk)("td",null,[s.tempOrder.is_paid?((0,l.uX)(),(0,l.CE)("strong",A,"已付款")):((0,l.uX)(),(0,l.CE)("span",D,"尚未付款"))])]),(0,l.Lk)("tr",null,[t[10]||(t[10]=(0,l.Lk)("th",null,"總金額",-1)),(0,l.Lk)("td",null,(0,r.v_)(e.$filters.currency(s.tempOrder.total)),1)])])]),t[13]||(t[13]=(0,l.Lk)("h3",null,"選購商品",-1)),(0,l.Lk)("table",K,[t[11]||(t[11]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr")],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.tempOrder.products,(t=>((0,l.uX)(),(0,l.CE)("tr",{key:t.id},[(0,l.Lk)("th",null,(0,r.v_)(t.product.title),1),(0,l.Lk)("td",null,(0,r.v_)(t.qty)+" / "+(0,r.v_)(t.product.unit),1),(0,l.Lk)("td",I,(0,r.v_)(e.$filters.currency(t.final_total)),1)])))),128))])])])])]),(0,l.Lk)("div",U,[t[14]||(t[14]=(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$emit("update-order",s.tempOrder))},"確認")])])])],512)}var N=a(3286),S={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{},isPaid:!1}},emits:["update-order"],mixins:[N.A],inject:["emitter"],watch:{order(){this.tempOrder=this.order,this.isPaid=this.tempOrder.is_paid}}},q=a(1241);const V=(0,q.A)(S,[["render",j]]);var H=V,Q=a(3773),z=a(4245),B={components:{orderModal:H,deleteOrderModal:Q.A,pagination:z.A},data(){return{orders:{},pagination:{},tempOrder:{},isNew:!1,isLoading:!1,currentPage:1}},methods:{getOrders(e=1){this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/api/aida-api/admin/orders?page=${e}`;this.isLoading=!0,this.$http.get(t,this.tempProduct).then((e=>{this.isLoading=!1,this.orders=e.data.orders,this.pagination=e.data.pagination,this.has_next=e.data.has_next,this.has_pre=e.data.has_pre}))},openModal(e,t){this.tempOrder=e?{}:{...t},this.isNew=e;const a=this.$refs.orderModal;a.showModal()},openDeleteModal(e){this.tempOrder={...e};const t=this.$refs.deleteOrderModal;t.showModal()},updateOrder(e){this.tempOrder=e;const t=`https://vue3-course-api.hexschool.io/api/aida-api/admin/order/${e.id}`,a={is_paid:e.is_paid};this.isLoading=!0;const l=this.$refs.orderModal;this.$http.put(t,{data:a}).then((e=>{console.log(e.data),this.isLoading=!1,l.hideModal(),this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態")}))},deleteOrder(){const e=`https://vue3-course-api.hexschool.io/api/aida-api/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(e).then((e=>{this.isLoading=!1;const t=this.$refs.deleteOrderModal;t.hideModal(),this.getOrders(this.currentPage)}))}},created(){this.getOrders()}};const G=(0,q.A)(B,[["render",O]]);var J=G}}]);
//# sourceMappingURL=76.48835755.js.map
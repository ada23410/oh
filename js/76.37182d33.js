"use strict";(self["webpackChunkoh"]=self["webpackChunkoh"]||[]).push([[76],{4245:function(e,t,a){a.d(t,{A:function(){return k}});var l=a(6768),r=a(4232),d=a(5130);const s={"aria-label":"Page navigation"},n={class:"pagination justify-content-center"},i=["onClick"];function o(e,t,a,o,u,p){return(0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("ul",n,[(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:!a.pages.has_pre}])},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,d.D$)((e=>p.updatePage(a.pages.current_page-1)),["prevent"]))},t[2]||(t[2]=[(0,l.Lk)("span",{"aria-hidden":"true"},"«",-1)]))],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.pages.total_pages,(e=>((0,l.uX)(),(0,l.CE)("li",{class:(0,r.C4)(["page-item",{active:e===a.pages.current_page}]),key:e},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:(0,d.D$)((t=>p.updatePage(e)),["prevent"])},(0,r.v_)(e),9,i)],2)))),128)),(0,l.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:!a.pages.has_next}])},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,d.D$)((e=>p.updatePage(a.pages.current_page+1)),["prevent"]))},t[3]||(t[3]=[(0,l.Lk)("span",{"aria-hidden":"true"},"»",-1)]))],2)])])}var u={props:["pages"],methods:{updatePage(e){this.$emit("emit-pages",e)}}},p=a(1241);const c=(0,p.A)(u,[["render",o]]);var k=c},76:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});var l=a(6768),r=a(4232),d=a(5130);const s={class:"card p-3"},n={class:"table"},i={class:"text-right"},o={class:"list-unstyled"},u={class:"text-right"},p={class:"form-check form-switch"},c=["id","onUpdate:modelValue","onChange"],k=["for"],h={key:0},L={key:1},m={class:"btn-group"},g=["onClick"],_=["onClick"],b={class:"pagination-wrapper"};function v(e,t,a,v,O,E){const f=(0,l.g2)("Loading"),C=(0,l.g2)("pagination"),y=(0,l.g2)("orderModal"),P=(0,l.g2)("deleteOrderModal");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(f,{active:O.isLoading},null,8,["active"]),t[1]||(t[1]=(0,l.Lk)("div",{class:"function"},[(0,l.Lk)("h5",null,"訂單管理")],-1)),(0,l.Lk)("div",s,[(0,l.Lk)("table",n,[t[0]||(t[0]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{width:"120"},"購買時間"),(0,l.Lk)("th",{width:"120"},"E-mail"),(0,l.Lk)("th",{width:"120"},"購買款項"),(0,l.Lk)("th",{width:"100"},"應付金額"),(0,l.Lk)("th",{width:"100"},"是否付款"),(0,l.Lk)("th",{width:"120"},"編輯")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(O.orders,((t,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:a},[(0,l.Lk)("td",null,(0,r.v_)(e.$filters.date(t.create_at)),1),(0,l.Lk)("td",null,(0,r.v_)(t.user.email),1),(0,l.Lk)("td",i,[(0,l.Lk)("ul",o,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.products,((e,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t},(0,r.v_)(e.product.title)+" 數量："+(0,r.v_)(e.qty)+" "+(0,r.v_)(e.product.unit),1)))),128))])]),(0,l.Lk)("td",u,(0,r.v_)(t.total),1),(0,l.Lk)("td",null,[(0,l.Lk)("div",p,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${t.id}`,"onUpdate:modelValue":e=>t.is_paid=e,onChange:e=>E.updateOrder(t)},null,40,c),[[d.lH,t.is_paid]]),(0,l.Lk)("label",{class:"form-check-label",for:`paidSwitch${t.id}`},[t.is_paid?((0,l.uX)(),(0,l.CE)("span",h,"已付款")):((0,l.uX)(),(0,l.CE)("span",L,"未付款"))],8,k)])]),(0,l.Lk)("td",null,[(0,l.Lk)("div",m,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>E.openModal(!1,t)},"檢視",8,g),(0,l.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>E.openDeleteModal(t)},"刪除",8,_)])])])))),128))])])]),(0,l.Lk)("div",b,[(0,l.bF)(C,{pages:O.pagination,onEmitPages:E.getOrders},null,8,["pages","onEmitPages"])]),(0,l.bF)(y,{ref:"orderModal",order:O.tempOrder,onUpdateOrder:E.updateOrder},null,8,["order","onUpdateOrder"]),(0,l.bF)(P,{ref:"deleteOrderModal",order:O.tempOrder,onConfirmDelete:E.deleteOrder},null,8,["order","onConfirmDelete"])],64)}const O={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog modal-xl",role:"document"},f={class:"modal-content border-0"},C={class:"modal-body"},y={class:"row"},P={class:"col-md-4"},$={class:"table"},A={key:0},M={class:"col-md-8"},w={class:"table"},x={key:0},X={key:1},U={key:0,class:"text-success"},N={key:1,class:"text-muted"},V={class:"table"},D={class:"text-end"},F={class:"modal-footer"};function S(e,t,a,d,s,n){return(0,l.uX)(),(0,l.CE)("div",O,[(0,l.Lk)("div",E,[(0,l.Lk)("div",f,[t[15]||(t[15]=(0,l.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,l.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l.Lk)("span",null,"訂單細節")]),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",C,[(0,l.Lk)("div",y,[(0,l.Lk)("div",P,[t[5]||(t[5]=(0,l.Lk)("h3",null,"用戶資料",-1)),(0,l.Lk)("table",$,[s.tempOrder.user?((0,l.uX)(),(0,l.CE)("tbody",A,[(0,l.Lk)("tr",null,[t[1]||(t[1]=(0,l.Lk)("th",{style:{width:"100px"}},"姓名",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.name),1)]),(0,l.Lk)("tr",null,[t[2]||(t[2]=(0,l.Lk)("th",null,"Email",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.email),1)]),(0,l.Lk)("tr",null,[t[3]||(t[3]=(0,l.Lk)("th",null,"電話",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.tel),1)]),(0,l.Lk)("tr",null,[t[4]||(t[4]=(0,l.Lk)("th",null,"地址",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.user.address),1)])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",M,[t[12]||(t[12]=(0,l.Lk)("h3",null,"訂單細節",-1)),(0,l.Lk)("table",w,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[t[6]||(t[6]=(0,l.Lk)("th",{style:{width:"100px"}},"訂單編號",-1)),(0,l.Lk)("td",null,(0,r.v_)(s.tempOrder.id),1)]),(0,l.Lk)("tr",null,[t[7]||(t[7]=(0,l.Lk)("th",null,"下單時間",-1)),(0,l.Lk)("td",null,(0,r.v_)(e.$filters.date(s.tempOrder.create_at)),1)]),(0,l.Lk)("tr",null,[t[8]||(t[8]=(0,l.Lk)("th",null,"付款時間",-1)),(0,l.Lk)("td",null,[s.tempOrder.paid_date?((0,l.uX)(),(0,l.CE)("span",x,(0,r.v_)(e.$filters.date(s.tempOrder.paid_date)),1)):((0,l.uX)(),(0,l.CE)("span",X,"時間不正確"))])]),(0,l.Lk)("tr",null,[t[9]||(t[9]=(0,l.Lk)("th",null,"付款狀態",-1)),(0,l.Lk)("td",null,[s.tempOrder.is_paid?((0,l.uX)(),(0,l.CE)("strong",U,"已付款")):((0,l.uX)(),(0,l.CE)("span",N,"尚未付款"))])]),(0,l.Lk)("tr",null,[t[10]||(t[10]=(0,l.Lk)("th",null,"總金額",-1)),(0,l.Lk)("td",null,(0,r.v_)(e.$filters.currency(s.tempOrder.total)),1)])])]),t[13]||(t[13]=(0,l.Lk)("h3",null,"選購商品",-1)),(0,l.Lk)("table",V,[t[11]||(t[11]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr")],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.tempOrder.products,(t=>((0,l.uX)(),(0,l.CE)("tr",{key:t.id},[(0,l.Lk)("th",null,(0,r.v_)(t.product.title),1),(0,l.Lk)("td",null,(0,r.v_)(t.qty)+" / "+(0,r.v_)(t.product.unit),1),(0,l.Lk)("td",D,(0,r.v_)(e.$filters.currency(t.final_total)),1)])))),128))])])])])]),(0,l.Lk)("div",F,[t[14]||(t[14]=(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$emit("update-order",s.tempOrder))},"確認")])])])],512)}var I=a(3286),B={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{},isPaid:!1}},emits:["update-order"],mixins:[I.A],inject:["emitter"],watch:{order(){this.tempOrder=this.order,this.isPaid=this.tempOrder.is_paid}}},R=a(1241);const K=(0,R.A)(B,[["render",S]]);var H=K,j=a(3773),T=a(4245),q={components:{orderModal:H,deleteOrderModal:j.A,pagination:T.A},data(){return{orders:{},pagination:{},tempOrder:{},isNew:!1,isLoading:!1,currentPage:1}},methods:{getOrders(e=1){this.currentPage=e;const t=`${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_API}api/${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_PATH}/admin/orders?page=${e}`;this.isLoading=!0,this.$http.get(t,this.tempProduct).then((e=>{this.isLoading=!1,this.orders=e.data.orders,this.pagination=e.data.pagination,this.has_next=e.data.has_next,this.has_pre=e.data.has_pre}))},openModal(e,t){this.tempOrder=e?{}:{...t},this.isNew=e;const a=this.$refs.orderModal;a.showModal()},openDeleteModal(e){this.tempOrder={...e};const t=this.$refs.deleteOrderModal;t.showModal()},updateOrder(e){this.tempOrder=e;const t=`${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_API}api/${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_PATH}/admin/order/${e.id}`,a={is_paid:e.is_paid};this.isLoading=!0;const l=this.$refs.orderModal;this.$http.put(t,{data:a}).then((e=>{console.log(e.data),this.isLoading=!1,l.hideModal(),this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態")}))},deleteOrder(){const e=`${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_API}api/${{NODE_ENV:"production",BASE_URL:"/oh/"}.VUE_APP_PATH}/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(e).then((e=>{this.isLoading=!1;const t=this.$refs.deleteOrderModal;t.hideModal(),this.getOrders(this.currentPage)}))}},created(){this.getOrders()}};const Q=(0,R.A)(q,[["render",v]]);var z=Q}}]);
//# sourceMappingURL=76.37182d33.js.map